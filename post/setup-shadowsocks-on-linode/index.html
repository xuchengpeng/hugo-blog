<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Linode 上搭建 Shadowsocks | Chuck</title><meta name=keywords content="Linode,Shadowsocks,bbr"><meta name=description content="VPS 选择
Linode
老大哥Linode近年最大的变化是，倍感digitalocean和vultr的压力了。Linode近期最大的福利是，全面由原来的Xen架构改用最流行的KVM架构服务器，套餐内存全部翻倍！
例如，过去每月$10只能买1G内存套餐，现在你可购买Linode 2G套餐，目前最低$5可以买1G内存套餐，这也是最低套餐配置了，绝对具有性价比。
Linode也允许用户按月付费，仍然采用信用卡付款的方式。新增了Paypal付款方式，目前处于测试阶段。需要提醒中国用户，Paypal仍然会要求你绑定一张双币信用卡（支持国内发行的visa信用卡），所以你应当尽快申请一张属于自己的信用卡。
Linode日本机房长期缺货，无法购买。美国西海岸Fremont机房位于加州，是中国大陆用户最应当购买的机房位置。
Vultr
Vultr这两年的增长速度惊人，中国站长把原来digitalocean的服务器搬到了vultr，原因是vultr日本机房速度很快、同样的1G内存套餐，每月只要$8，具有超高性价比。
日本机房速度一直很快，没有绕行美国。今年9月初，杭州开会期间，Vultr日本机房线路突然变得非常慢，ping丢包严重，但是此事件仅持续了一周左右时间，又恢复正常，怀疑是中国电信国际出口线路调整导致的。在该期间，用户可把vps搬家到Vultr美国SFO机房，速度仍然很棒。
digitalocean
digitalocean新增SFO 2号机房，是对中国用户来说相当不错的选择。印度机房虽然距离中国近，但线路并未优化，速度不如美国西海岸机房。
价格方便，$10每月享受1G内存、2TB月流量、单核CPU、KVM架构，在当前竞争激烈的VPS市场，表现中庸。
digitalocean最大的变化是，过去三年间，中国买家疯狂涌入，导致线路表现不佳。大批用户搭建出国梯子，导致digitalocean机房很多IP被封。
不明就里的新用户兴奋地创建一个新账号，结果竟然ping不通服务器，无法连接ssh，其实是因为自动分配的IP被墙的原因。目前，digitalocean线路稳定，原因之一是竞争对手vultr把很多中国用户吸引了过去。"><meta name=author content="Chuck"><link rel=canonical href=https://xuchengpeng.github.io/post/setup-shadowsocks-on-linode/><link crossorigin=anonymous href=/assets/css/stylesheet.87a71c9fa3c46cbcceecb41d06747705e92409331a78d74e3ac78ce8b2f38eb1.css integrity="sha256-h6ccn6PEbLzO7LQdBnR3BekkCTMaeNdOOseM6LLzjrE=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://xuchengpeng.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://xuchengpeng.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://xuchengpeng.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://xuchengpeng.github.io/apple-touch-icon.png><link rel=mask-icon href=https://xuchengpeng.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Linode 上搭建 Shadowsocks"><meta property="og:description" content="VPS 选择
Linode
老大哥Linode近年最大的变化是，倍感digitalocean和vultr的压力了。Linode近期最大的福利是，全面由原来的Xen架构改用最流行的KVM架构服务器，套餐内存全部翻倍！
例如，过去每月$10只能买1G内存套餐，现在你可购买Linode 2G套餐，目前最低$5可以买1G内存套餐，这也是最低套餐配置了，绝对具有性价比。
Linode也允许用户按月付费，仍然采用信用卡付款的方式。新增了Paypal付款方式，目前处于测试阶段。需要提醒中国用户，Paypal仍然会要求你绑定一张双币信用卡（支持国内发行的visa信用卡），所以你应当尽快申请一张属于自己的信用卡。
Linode日本机房长期缺货，无法购买。美国西海岸Fremont机房位于加州，是中国大陆用户最应当购买的机房位置。
Vultr
Vultr这两年的增长速度惊人，中国站长把原来digitalocean的服务器搬到了vultr，原因是vultr日本机房速度很快、同样的1G内存套餐，每月只要$8，具有超高性价比。
日本机房速度一直很快，没有绕行美国。今年9月初，杭州开会期间，Vultr日本机房线路突然变得非常慢，ping丢包严重，但是此事件仅持续了一周左右时间，又恢复正常，怀疑是中国电信国际出口线路调整导致的。在该期间，用户可把vps搬家到Vultr美国SFO机房，速度仍然很棒。
digitalocean
digitalocean新增SFO 2号机房，是对中国用户来说相当不错的选择。印度机房虽然距离中国近，但线路并未优化，速度不如美国西海岸机房。
价格方便，$10每月享受1G内存、2TB月流量、单核CPU、KVM架构，在当前竞争激烈的VPS市场，表现中庸。
digitalocean最大的变化是，过去三年间，中国买家疯狂涌入，导致线路表现不佳。大批用户搭建出国梯子，导致digitalocean机房很多IP被封。
不明就里的新用户兴奋地创建一个新账号，结果竟然ping不通服务器，无法连接ssh，其实是因为自动分配的IP被墙的原因。目前，digitalocean线路稳定，原因之一是竞争对手vultr把很多中国用户吸引了过去。"><meta property="og:type" content="article"><meta property="og:url" content="https://xuchengpeng.github.io/post/setup-shadowsocks-on-linode/"><meta property="article:section" content="post"><meta property="article:published_time" content="2018-04-13T09:08:00+00:00"><meta property="article:modified_time" content="2018-04-13T09:08:00+00:00"><meta property="og:site_name" content="Chuck"><meta name=twitter:card content="summary"><meta name=twitter:title content="Linode 上搭建 Shadowsocks"><meta name=twitter:description content="VPS 选择
Linode
老大哥Linode近年最大的变化是，倍感digitalocean和vultr的压力了。Linode近期最大的福利是，全面由原来的Xen架构改用最流行的KVM架构服务器，套餐内存全部翻倍！
例如，过去每月$10只能买1G内存套餐，现在你可购买Linode 2G套餐，目前最低$5可以买1G内存套餐，这也是最低套餐配置了，绝对具有性价比。
Linode也允许用户按月付费，仍然采用信用卡付款的方式。新增了Paypal付款方式，目前处于测试阶段。需要提醒中国用户，Paypal仍然会要求你绑定一张双币信用卡（支持国内发行的visa信用卡），所以你应当尽快申请一张属于自己的信用卡。
Linode日本机房长期缺货，无法购买。美国西海岸Fremont机房位于加州，是中国大陆用户最应当购买的机房位置。
Vultr
Vultr这两年的增长速度惊人，中国站长把原来digitalocean的服务器搬到了vultr，原因是vultr日本机房速度很快、同样的1G内存套餐，每月只要$8，具有超高性价比。
日本机房速度一直很快，没有绕行美国。今年9月初，杭州开会期间，Vultr日本机房线路突然变得非常慢，ping丢包严重，但是此事件仅持续了一周左右时间，又恢复正常，怀疑是中国电信国际出口线路调整导致的。在该期间，用户可把vps搬家到Vultr美国SFO机房，速度仍然很棒。
digitalocean
digitalocean新增SFO 2号机房，是对中国用户来说相当不错的选择。印度机房虽然距离中国近，但线路并未优化，速度不如美国西海岸机房。
价格方便，$10每月享受1G内存、2TB月流量、单核CPU、KVM架构，在当前竞争激烈的VPS市场，表现中庸。
digitalocean最大的变化是，过去三年间，中国买家疯狂涌入，导致线路表现不佳。大批用户搭建出国梯子，导致digitalocean机房很多IP被封。
不明就里的新用户兴奋地创建一个新账号，结果竟然ping不通服务器，无法连接ssh，其实是因为自动分配的IP被墙的原因。目前，digitalocean线路稳定，原因之一是竞争对手vultr把很多中国用户吸引了过去。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://xuchengpeng.github.io/post/"},{"@type":"ListItem","position":2,"name":"Linode 上搭建 Shadowsocks","item":"https://xuchengpeng.github.io/post/setup-shadowsocks-on-linode/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Linode 上搭建 Shadowsocks","name":"Linode 上搭建 Shadowsocks","description":"VPS 选择 Linode 老大哥Linode近年最大的变化是，倍感digitalocean和vultr的压力了。Linode近期最大的福利是，全面由原来的Xen架构改用最流行的KVM架构服务器，套餐内存全部翻倍！\n例如，过去每月$10只能买1G内存套餐，现在你可购买Linode 2G套餐，目前最低$5可以买1G内存套餐，这也是最低套餐配置了，绝对具有性价比。\nLinode也允许用户按月付费，仍然采用信用卡付款的方式。新增了Paypal付款方式，目前处于测试阶段。需要提醒中国用户，Paypal仍然会要求你绑定一张双币信用卡（支持国内发行的visa信用卡），所以你应当尽快申请一张属于自己的信用卡。\nLinode日本机房长期缺货，无法购买。美国西海岸Fremont机房位于加州，是中国大陆用户最应当购买的机房位置。\nVultr Vultr这两年的增长速度惊人，中国站长把原来digitalocean的服务器搬到了vultr，原因是vultr日本机房速度很快、同样的1G内存套餐，每月只要$8，具有超高性价比。\n日本机房速度一直很快，没有绕行美国。今年9月初，杭州开会期间，Vultr日本机房线路突然变得非常慢，ping丢包严重，但是此事件仅持续了一周左右时间，又恢复正常，怀疑是中国电信国际出口线路调整导致的。在该期间，用户可把vps搬家到Vultr美国SFO机房，速度仍然很棒。\ndigitalocean digitalocean新增SFO 2号机房，是对中国用户来说相当不错的选择。印度机房虽然距离中国近，但线路并未优化，速度不如美国西海岸机房。\n价格方便，$10每月享受1G内存、2TB月流量、单核CPU、KVM架构，在当前竞争激烈的VPS市场，表现中庸。\ndigitalocean最大的变化是，过去三年间，中国买家疯狂涌入，导致线路表现不佳。大批用户搭建出国梯子，导致digitalocean机房很多IP被封。\n不明就里的新用户兴奋地创建一个新账号，结果竟然ping不通服务器，无法连接ssh，其实是因为自动分配的IP被墙的原因。目前，digitalocean线路稳定，原因之一是竞争对手vultr把很多中国用户吸引了过去。\n","keywords":["Linode","Shadowsocks","bbr"],"articleBody":"VPS 选择 Linode 老大哥Linode近年最大的变化是，倍感digitalocean和vultr的压力了。Linode近期最大的福利是，全面由原来的Xen架构改用最流行的KVM架构服务器，套餐内存全部翻倍！\n例如，过去每月$10只能买1G内存套餐，现在你可购买Linode 2G套餐，目前最低$5可以买1G内存套餐，这也是最低套餐配置了，绝对具有性价比。\nLinode也允许用户按月付费，仍然采用信用卡付款的方式。新增了Paypal付款方式，目前处于测试阶段。需要提醒中国用户，Paypal仍然会要求你绑定一张双币信用卡（支持国内发行的visa信用卡），所以你应当尽快申请一张属于自己的信用卡。\nLinode日本机房长期缺货，无法购买。美国西海岸Fremont机房位于加州，是中国大陆用户最应当购买的机房位置。\nVultr Vultr这两年的增长速度惊人，中国站长把原来digitalocean的服务器搬到了vultr，原因是vultr日本机房速度很快、同样的1G内存套餐，每月只要$8，具有超高性价比。\n日本机房速度一直很快，没有绕行美国。今年9月初，杭州开会期间，Vultr日本机房线路突然变得非常慢，ping丢包严重，但是此事件仅持续了一周左右时间，又恢复正常，怀疑是中国电信国际出口线路调整导致的。在该期间，用户可把vps搬家到Vultr美国SFO机房，速度仍然很棒。\ndigitalocean digitalocean新增SFO 2号机房，是对中国用户来说相当不错的选择。印度机房虽然距离中国近，但线路并未优化，速度不如美国西海岸机房。\n价格方便，$10每月享受1G内存、2TB月流量、单核CPU、KVM架构，在当前竞争激烈的VPS市场，表现中庸。\ndigitalocean最大的变化是，过去三年间，中国买家疯狂涌入，导致线路表现不佳。大批用户搭建出国梯子，导致digitalocean机房很多IP被封。\n不明就里的新用户兴奋地创建一个新账号，结果竟然ping不通服务器，无法连接ssh，其实是因为自动分配的IP被墙的原因。目前，digitalocean线路稳定，原因之一是竞争对手vultr把很多中国用户吸引了过去。\n注册/申请服务器 注册账号 登陆 Linode 注册账号，需要绑定一张信用卡，注册时填写邀请码(0a89daeb73aede849b760c66127f1bb8960c73dc)可获得奖励。\n申请服务器 Add a Linode 创建服务器 Select an instance type 因为这里只做流量转发，所以选最小的类型:1024 Location 服务器位置选 Fremont, CA 点击 Add This Linode 配置操作系统镜像 进入 Linodes 界面，点击 Deploy an Image。 操作系统镜像选择 Ubuntu 16.04 LTS，输入 root 用户密码，其他保持默认。 Boot 启动服务器。 更新系统 # 更新源 $ apt-get update # 更新已安装的包 $ apt-get upgrade # 升级系统 $ apt-get dist-upgrade 更新完成后 reboot 重新启动系统。\n开启 bbr BBR是Google开源的TCP拥堵控制算法，与2016年9月开源。BBR的目的是要尽量跑满带宽, 并且尽量不要有排队的情况。 linux 内核4.9版本以上已集成了bbr算法支持，使用 uname -r查看内核版本。\n$ uname -r 4.15.12-x86_64-linode105 执行以下命令修改系统配置并保存：\n$ echo \"net.ipv4.tcp_congestion_control=bbr\" \u003e\u003e /etc/sysctl.conf $ sysctl -p 检查系统配置：\n$ sysctl net.ipv4.tcp_available_congestion_control net.ipv4.tcp_available_congestion_control = reno bbr bic cubic westwood htcp $ sysctl net.ipv4.tcp_congestion_control net.ipv4.tcp_congestion_control = bbr Linux 4.13内核版本及以上，不再需要配置 net.core.default_qdisc=fq。\n优化 Step 1 修改 /etc/security/limits.conf 文件，加入以下两行：\n* soft nofile 51200 * hard nofile 51200 执行 ulimit -n 51200 命令。\nStep 2 修改 /etc/sysctl.conf 文件，增加以下配置：\nfs.file-max = 51200 net.core.rmem_max = 67108864 net.core.wmem_max = 67108864 net.core.netdev_max_backlog = 250000 net.core.somaxconn = 4096 net.ipv4.tcp_syncookies = 1 net.ipv4.tcp_tw_reuse = 1 net.ipv4.tcp_tw_recycle = 0 net.ipv4.tcp_fin_timeout = 30 net.ipv4.tcp_keepalive_time = 1200 net.ipv4.ip_local_port_range = 10000 65000 net.ipv4.tcp_max_syn_backlog = 8192 net.ipv4.tcp_max_tw_buckets = 5000 net.ipv4.tcp_fastopen = 3 net.ipv4.tcp_mem = 25600 51200 102400 net.ipv4.tcp_rmem = 4096 87380 67108864 net.ipv4.tcp_wmem = 4096 65536 67108864 net.ipv4.tcp_mtu_probing = 1 net.ipv4.tcp_congestion_control = bbr 执行 sysctl -p 生效。\n搭建 Shadowsocks libsodium 安装 $ apt-get install build-essential $ wget -N --no-check-certificate https://github.com/jedisct1/libsodium/releases/download/1.0.16/libsodium-1.0.16.tar.gz $ tar zxvf libsodium-1.0.16.tar.gz $ pushd libsodium-1.0.16 $ ./configure --prefix=/usr \u0026\u0026 make $ make install $ popd $ ldconfig Shadowsocks-python 安装 Shadowsocks-python $ apt-get update $ apt-get install python-pip $ pip install shadowsocks 或者是通过源码安装最新版 Shadowsocks-python\n$ apt-get update $ apt-get install python-pip $ apt-get install git $ pip install git+https://github.com/shadowsocks/shadowsocks.git@master 配置 Shadowsocks 修改 /etc/shadowsocks-python/config.json 文件，填入以下内容：\n{ \"server\":\"xxx.xxx.xxx.xxx\", \"server_port\":8388, \"local_address\":\"127.0.0.1\", \"local_port\":1080, \"password\":\"xxxxxxxx\", \"timeout\":300, \"method\":\"aes-256-gcm\", \"fast_open\": false } 多用户配置：\n{ \"server\": \"xxx.xxx.xxx.xxx\", \"port_password\": { \"8381\": \"xxxxxxxx\", \"8382\": \"xxxxxxxx\", \"8383\": \"xxxxxxxx\", \"8384\": \"xxxxxxxx\" }, \"timeout\": 300, \"method\": \"aes-256-gcm\" } 开启服务 # 启动服务 $ ssserver -c /etc/shadowsocks-python/config.json -d start # 关闭服务 $ ssserver -c /etc/shadowsocks-python/config.json -d stop Shadowsocks-libev 安装 mbedtls $ wget https://tls.mbed.org/download/mbedtls-2.8.0-gpl.tgz $ tar xvf mbedtls-2.8.0-gpl.tgz $ pushd mbedtls-2.8.0 $ make SHARED=1 CFLAGS=-fPIC $ sudo make DESTDIR=/usr install $ popd $ sudo ldconfig 安装 Shadowsocks-libev Ubuntu 14.04 and 16.04:\n$ sudo add-apt-repository ppa:max-c-lv/shadowsocks-libev -y $ sudo apt-get update $ sudo apt-get install shadowsocks-libev Ubuntu 16.10 or higher:\n$ sudo apt-get update $ sudo apt-get install shadowsocks-libev 开启服务 # 启动 $ /etc/init.d/shadowsocks-libev start # 停止 $ /etc/init.d/shadowsocks-libev stop # 重启 $ /etc/init.d/shadowsocks-libev restart # 查看状态 $ /etc/init.d/shadowsocks-libev status Shadowsocks-go 安装 Shadowsocks-go $ apt-get install golang 编辑 ~/.bashrc，加入以下内容:\nexport GOPATH=/usr/gopath export PATH=$PATH:$GOPATH/bin 执行 source ~/.bashrc使设置生效。然后再执行以下命令安装 Shadowsocks-go：\n$ go get github.com/shadowsocks/shadowsocks-go/cmd/shadowsocks-server 启动服务 # 后台启动 $ shadowsocks-server -c /etc/shadowsocks-go/config.json \u003e /usr/gopath/log/log \u0026 ","wordCount":"436","inLanguage":"en","datePublished":"2018-04-13T09:08:00Z","dateModified":"2018-04-13T09:08:00Z","author":{"@type":"Person","name":"Chuck"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xuchengpeng.github.io/post/setup-shadowsocks-on-linode/"},"publisher":{"@type":"Organization","name":"Chuck","logo":{"@type":"ImageObject","url":"https://xuchengpeng.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xuchengpeng.github.io/ accesskey=h title="Chuck (Alt + H)"><img src=https://xuchengpeng.github.io/apple-touch-icon.png alt aria-label=logo height=35>Chuck</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://xuchengpeng.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://xuchengpeng.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://xuchengpeng.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://xuchengpeng.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://xuchengpeng.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://xuchengpeng.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://xuchengpeng.github.io/post/>Posts</a></div><h1 class=post-title>Linode 上搭建 Shadowsocks</h1><div class=post-meta><span title='2018-04-13 09:08:00 +0000 UTC'>April 13, 2018</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;436 words&nbsp;·&nbsp;Chuck&nbsp;|&nbsp;<a href=https://github.com/xuchengpeng/xuchengpeng.github.io/tree/main/content/post/setup-shadowsocks-on-linode.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#vps-选择>VPS 选择</a><ul><li><a href=#linodehttpswwwlinodecomr0a89daeb73aede849b760c66127f1bb8960c73dc><a href="https://www.linode.com/?r=0a89daeb73aede849b760c66127f1bb8960c73dc">Linode</a></a></li><li><a href=#vultrwwwvultrcom><a href=www.vultr.com>Vultr</a></a></li><li><a href=#digitaloceanwwwdigitaloceancom><a href=www.digitalocean.com>digitalocean</a></a></li></ul></li><li><a href=#注册申请服务器>注册/申请服务器</a><ul><li><a href=#注册账号>注册账号</a></li><li><a href=#申请服务器>申请服务器</a></li><li><a href=#配置操作系统镜像>配置操作系统镜像</a></li><li><a href=#更新系统>更新系统</a></li><li><a href=#开启-bbr>开启 bbr</a></li><li><a href=#优化>优化</a></li></ul></li><li><a href=#搭建-shadowsocks>搭建 Shadowsocks</a><ul><li><a href=#libsodium-安装>libsodium 安装</a></li><li><a href=#shadowsocks-python>Shadowsocks-python</a></li><li><a href=#shadowsocks-libev>Shadowsocks-libev</a></li><li><a href=#shadowsocks-go>Shadowsocks-go</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=vps-选择>VPS 选择<a hidden class=anchor aria-hidden=true href=#vps-选择>#</a></h2><h3 id=linodehttpswwwlinodecomr0a89daeb73aede849b760c66127f1bb8960c73dc><a href="https://www.linode.com/?r=0a89daeb73aede849b760c66127f1bb8960c73dc">Linode</a><a hidden class=anchor aria-hidden=true href=#linodehttpswwwlinodecomr0a89daeb73aede849b760c66127f1bb8960c73dc>#</a></h3><p>老大哥Linode近年最大的变化是，倍感digitalocean和vultr的压力了。Linode近期最大的福利是，全面由原来的Xen架构改用最流行的KVM架构服务器，套餐内存全部翻倍！</p><p>例如，过去每月$10只能买1G内存套餐，现在你可购买Linode 2G套餐，目前最低$5可以买1G内存套餐，这也是最低套餐配置了，绝对具有性价比。</p><p>Linode也允许用户按月付费，仍然采用信用卡付款的方式。新增了Paypal付款方式，目前处于测试阶段。需要提醒中国用户，Paypal仍然会要求你绑定一张双币信用卡（支持国内发行的visa信用卡），所以你应当尽快申请一张属于自己的信用卡。</p><p>Linode日本机房长期缺货，无法购买。美国西海岸Fremont机房位于加州，是中国大陆用户最应当购买的机房位置。</p><h3 id=vultrwwwvultrcom><a href=www.vultr.com>Vultr</a><a hidden class=anchor aria-hidden=true href=#vultrwwwvultrcom>#</a></h3><p>Vultr这两年的增长速度惊人，中国站长把原来digitalocean的服务器搬到了vultr，原因是vultr日本机房速度很快、同样的1G内存套餐，每月只要$8，具有超高性价比。</p><p>日本机房速度一直很快，没有绕行美国。今年9月初，杭州开会期间，Vultr日本机房线路突然变得非常慢，ping丢包严重，但是此事件仅持续了一周左右时间，又恢复正常，怀疑是中国电信国际出口线路调整导致的。在该期间，用户可把vps搬家到Vultr美国SFO机房，速度仍然很棒。</p><h3 id=digitaloceanwwwdigitaloceancom><a href=www.digitalocean.com>digitalocean</a><a hidden class=anchor aria-hidden=true href=#digitaloceanwwwdigitaloceancom>#</a></h3><p>digitalocean新增SFO 2号机房，是对中国用户来说相当不错的选择。印度机房虽然距离中国近，但线路并未优化，速度不如美国西海岸机房。</p><p>价格方便，$10每月享受1G内存、2TB月流量、单核CPU、KVM架构，在当前竞争激烈的VPS市场，表现中庸。</p><p>digitalocean最大的变化是，过去三年间，中国买家疯狂涌入，导致线路表现不佳。大批用户搭建出国梯子，导致digitalocean机房很多IP被封。</p><p>不明就里的新用户兴奋地创建一个新账号，结果竟然ping不通服务器，无法连接ssh，其实是因为自动分配的IP被墙的原因。目前，digitalocean线路稳定，原因之一是竞争对手vultr把很多中国用户吸引了过去。</p><h2 id=注册申请服务器>注册/申请服务器<a hidden class=anchor aria-hidden=true href=#注册申请服务器>#</a></h2><h3 id=注册账号>注册账号<a hidden class=anchor aria-hidden=true href=#注册账号>#</a></h3><p>登陆 <a href="https://www.linode.com/?r=0a89daeb73aede849b760c66127f1bb8960c73dc">Linode</a> 注册账号，需要绑定一张信用卡，注册时填写邀请码(<strong>0a89daeb73aede849b760c66127f1bb8960c73dc</strong>)可获得奖励。</p><h3 id=申请服务器>申请服务器<a hidden class=anchor aria-hidden=true href=#申请服务器>#</a></h3><ul><li>Add a Linode 创建服务器</li><li>Select an instance type 因为这里只做流量转发，所以选最小的类型:1024</li><li>Location 服务器位置选 <strong>Fremont, CA</strong></li><li>点击 Add This Linode</li></ul><h3 id=配置操作系统镜像>配置操作系统镜像<a hidden class=anchor aria-hidden=true href=#配置操作系统镜像>#</a></h3><ul><li>进入 Linodes 界面，点击 <strong>Deploy an Image</strong>。</li><li>操作系统镜像选择 <strong>Ubuntu 16.04 LTS</strong>，输入 root 用户密码，其他保持默认。</li><li>Boot 启动服务器。</li></ul><h3 id=更新系统>更新系统<a hidden class=anchor aria-hidden=true href=#更新系统>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 更新源</span>
</span></span><span class=line><span class=cl>$ apt-get update
</span></span><span class=line><span class=cl><span class=c1># 更新已安装的包</span>
</span></span><span class=line><span class=cl>$ apt-get upgrade
</span></span><span class=line><span class=cl><span class=c1># 升级系统</span>
</span></span><span class=line><span class=cl>$ apt-get dist-upgrade
</span></span></code></pre></div><p>更新完成后 reboot 重新启动系统。</p><h3 id=开启-bbr>开启 bbr<a hidden class=anchor aria-hidden=true href=#开启-bbr>#</a></h3><p>BBR是Google开源的TCP拥堵控制算法，与2016年9月开源。BBR的目的是要尽量跑满带宽, 并且尽量不要有排队的情况。
linux 内核4.9版本以上已集成了bbr算法支持，使用 <strong>uname -r</strong>查看内核版本。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ uname -r
</span></span><span class=line><span class=cl>4.15.12-x86_64-linode105
</span></span></code></pre></div><p>执行以下命令修改系统配置并保存：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=s2>&#34;net.ipv4.tcp_congestion_control=bbr&#34;</span> &gt;&gt; /etc/sysctl.conf
</span></span><span class=line><span class=cl>$ sysctl -p
</span></span></code></pre></div><p>检查系统配置：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ sysctl net.ipv4.tcp_available_congestion_control
</span></span><span class=line><span class=cl>net.ipv4.tcp_available_congestion_control <span class=o>=</span> reno bbr bic cubic westwood htcp
</span></span><span class=line><span class=cl>$ sysctl net.ipv4.tcp_congestion_control
</span></span><span class=line><span class=cl>net.ipv4.tcp_congestion_control <span class=o>=</span> bbr
</span></span></code></pre></div><blockquote><p>Linux 4.13内核版本及以上，不再需要配置 <code>net.core.default_qdisc=fq</code>。</p></blockquote><h3 id=优化>优化<a hidden class=anchor aria-hidden=true href=#优化>#</a></h3><h4 id=step-1>Step 1<a hidden class=anchor aria-hidden=true href=#step-1>#</a></h4><p>修改 <code>/etc/security/limits.conf</code> 文件，加入以下两行：</p><pre tabindex=0><code>* soft nofile 51200
* hard nofile 51200
</code></pre><p>执行 <strong>ulimit -n 51200</strong> 命令。</p><h4 id=step-2>Step 2<a hidden class=anchor aria-hidden=true href=#step-2>#</a></h4><p>修改 <code>/etc/sysctl.conf</code> 文件，增加以下配置：</p><pre tabindex=0><code>fs.file-max = 51200

net.core.rmem_max = 67108864
net.core.wmem_max = 67108864
net.core.netdev_max_backlog = 250000
net.core.somaxconn = 4096

net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_tw_recycle = 0
net.ipv4.tcp_fin_timeout = 30
net.ipv4.tcp_keepalive_time = 1200
net.ipv4.ip_local_port_range = 10000 65000
net.ipv4.tcp_max_syn_backlog = 8192
net.ipv4.tcp_max_tw_buckets = 5000
net.ipv4.tcp_fastopen = 3
net.ipv4.tcp_mem = 25600 51200 102400
net.ipv4.tcp_rmem = 4096 87380 67108864
net.ipv4.tcp_wmem = 4096 65536 67108864
net.ipv4.tcp_mtu_probing = 1
net.ipv4.tcp_congestion_control = bbr
</code></pre><p>执行 <strong>sysctl -p</strong> 生效。</p><h2 id=搭建-shadowsocks>搭建 Shadowsocks<a hidden class=anchor aria-hidden=true href=#搭建-shadowsocks>#</a></h2><h3 id=libsodium-安装>libsodium 安装<a hidden class=anchor aria-hidden=true href=#libsodium-安装>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ apt-get install build-essential
</span></span><span class=line><span class=cl>$ wget -N --no-check-certificate https://github.com/jedisct1/libsodium/releases/download/1.0.16/libsodium-1.0.16.tar.gz
</span></span><span class=line><span class=cl>$ tar zxvf libsodium-1.0.16.tar.gz
</span></span><span class=line><span class=cl>$ <span class=nb>pushd</span> libsodium-1.0.16
</span></span><span class=line><span class=cl>$ ./configure --prefix<span class=o>=</span>/usr <span class=o>&amp;&amp;</span> make
</span></span><span class=line><span class=cl>$ make install
</span></span><span class=line><span class=cl>$ <span class=nb>popd</span>
</span></span><span class=line><span class=cl>$ ldconfig
</span></span></code></pre></div><h3 id=shadowsocks-python>Shadowsocks-python<a hidden class=anchor aria-hidden=true href=#shadowsocks-python>#</a></h3><h4 id=安装-shadowsocks-python>安装 Shadowsocks-python<a hidden class=anchor aria-hidden=true href=#安装-shadowsocks-python>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ apt-get update
</span></span><span class=line><span class=cl>$ apt-get install python-pip
</span></span><span class=line><span class=cl>$ pip install shadowsocks
</span></span></code></pre></div><p>或者是通过源码安装最新版 Shadowsocks-python</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ apt-get update
</span></span><span class=line><span class=cl>$ apt-get install python-pip
</span></span><span class=line><span class=cl>$ apt-get install git
</span></span><span class=line><span class=cl>$ pip install git+https://github.com/shadowsocks/shadowsocks.git@master
</span></span></code></pre></div><h4 id=配置-shadowsocks>配置 Shadowsocks<a hidden class=anchor aria-hidden=true href=#配置-shadowsocks>#</a></h4><p>修改 /etc/shadowsocks-python/config.json 文件，填入以下内容：</p><pre tabindex=0><code>{
    &#34;server&#34;:&#34;xxx.xxx.xxx.xxx&#34;,
    &#34;server_port&#34;:8388,
    &#34;local_address&#34;:&#34;127.0.0.1&#34;,
    &#34;local_port&#34;:1080,
    &#34;password&#34;:&#34;xxxxxxxx&#34;,
    &#34;timeout&#34;:300,
    &#34;method&#34;:&#34;aes-256-gcm&#34;,
    &#34;fast_open&#34;: false
}
</code></pre><p>多用户配置：</p><pre tabindex=0><code>{
    &#34;server&#34;: &#34;xxx.xxx.xxx.xxx&#34;,
    &#34;port_password&#34;: {
        &#34;8381&#34;: &#34;xxxxxxxx&#34;,
        &#34;8382&#34;: &#34;xxxxxxxx&#34;,
        &#34;8383&#34;: &#34;xxxxxxxx&#34;,
        &#34;8384&#34;: &#34;xxxxxxxx&#34;
    },
    &#34;timeout&#34;: 300,
    &#34;method&#34;: &#34;aes-256-gcm&#34;
}
</code></pre><h4 id=开启服务>开启服务<a hidden class=anchor aria-hidden=true href=#开启服务>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 启动服务</span>
</span></span><span class=line><span class=cl>$ ssserver -c /etc/shadowsocks-python/config.json -d start
</span></span><span class=line><span class=cl><span class=c1># 关闭服务</span>
</span></span><span class=line><span class=cl>$ ssserver -c /etc/shadowsocks-python/config.json -d stop
</span></span></code></pre></div><h3 id=shadowsocks-libev>Shadowsocks-libev<a hidden class=anchor aria-hidden=true href=#shadowsocks-libev>#</a></h3><h4 id=安装-mbedtls>安装 mbedtls<a hidden class=anchor aria-hidden=true href=#安装-mbedtls>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ wget https://tls.mbed.org/download/mbedtls-2.8.0-gpl.tgz
</span></span><span class=line><span class=cl>$ tar xvf mbedtls-2.8.0-gpl.tgz
</span></span><span class=line><span class=cl>$ <span class=nb>pushd</span> mbedtls-2.8.0
</span></span><span class=line><span class=cl>$ make <span class=nv>SHARED</span><span class=o>=</span><span class=m>1</span> <span class=nv>CFLAGS</span><span class=o>=</span>-fPIC
</span></span><span class=line><span class=cl>$ sudo make <span class=nv>DESTDIR</span><span class=o>=</span>/usr install
</span></span><span class=line><span class=cl>$ <span class=nb>popd</span>
</span></span><span class=line><span class=cl>$ sudo ldconfig
</span></span></code></pre></div><h4 id=安装-shadowsocks-libev>安装 Shadowsocks-libev<a hidden class=anchor aria-hidden=true href=#安装-shadowsocks-libev>#</a></h4><p>Ubuntu 14.04 and 16.04:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ sudo add-apt-repository ppa:max-c-lv/shadowsocks-libev -y
</span></span><span class=line><span class=cl>$ sudo apt-get update
</span></span><span class=line><span class=cl>$ sudo apt-get install shadowsocks-libev
</span></span></code></pre></div><p>Ubuntu 16.10 or higher:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ sudo apt-get update
</span></span><span class=line><span class=cl>$ sudo apt-get install shadowsocks-libev
</span></span></code></pre></div><h4 id=开启服务-1>开启服务<a hidden class=anchor aria-hidden=true href=#开启服务-1>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 启动</span>
</span></span><span class=line><span class=cl>$ /etc/init.d/shadowsocks-libev start
</span></span><span class=line><span class=cl><span class=c1># 停止</span>
</span></span><span class=line><span class=cl>$ /etc/init.d/shadowsocks-libev stop
</span></span><span class=line><span class=cl><span class=c1># 重启</span>
</span></span><span class=line><span class=cl>$ /etc/init.d/shadowsocks-libev restart
</span></span><span class=line><span class=cl><span class=c1># 查看状态</span>
</span></span><span class=line><span class=cl>$ /etc/init.d/shadowsocks-libev status
</span></span></code></pre></div><h3 id=shadowsocks-go>Shadowsocks-go<a hidden class=anchor aria-hidden=true href=#shadowsocks-go>#</a></h3><h4 id=安装-shadowsocks-go>安装 Shadowsocks-go<a hidden class=anchor aria-hidden=true href=#安装-shadowsocks-go>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ apt-get install golang
</span></span></code></pre></div><p>编辑 <code>~/.bashrc</code>，加入以下内容:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=nb>export</span> <span class=nv>GOPATH</span><span class=o>=</span>/usr/gopath
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=nv>$PATH</span>:<span class=nv>$GOPATH</span>/bin
</span></span></code></pre></div><p>执行 <code>source ~/.bashrc</code>使设置生效。然后再执行以下命令安装 Shadowsocks-go：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>$ go get github.com/shadowsocks/shadowsocks-go/cmd/shadowsocks-server
</span></span></code></pre></div><h4 id=启动服务>启动服务<a hidden class=anchor aria-hidden=true href=#启动服务>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># 后台启动</span>
</span></span><span class=line><span class=cl>$ shadowsocks-server -c /etc/shadowsocks-go/config.json &gt; /usr/gopath/log/log <span class=p>&amp;</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://xuchengpeng.github.io/tags/linode/>Linode</a></li><li><a href=https://xuchengpeng.github.io/tags/shadowsocks/>Shadowsocks</a></li><li><a href=https://xuchengpeng.github.io/tags/bbr/>bbr</a></li></ul><nav class=paginav><a class=prev href=https://xuchengpeng.github.io/post/ubuntu-add-delete-ppa/><span class=title>« Prev</span><br><span>Ubuntu 增加和删除 PPA 软件源</span></a>
<a class=next href=https://xuchengpeng.github.io/post/design-pattern-composite-pattern/><span class=title>Next »</span><br><span>组合模式</span></a></nav></footer><div class=article-comments><span id=/post/setup-shadowsocks-on-linode/ class=leancloud-visitors data-flag-title="Linode 上搭建 Shadowsocks"><span class=post-meta-item-text>文章阅读量</span>
<span class=leancloud-visitors-count>0</span></span><div id=vcomments></div><script src=//unpkg.com/valine/dist/Valine.min.js></script>
<script type=text/javascript>new Valine({el:"#vcomments",appId:"8cGx0mI721mXnuSact0PLKmV-gzGzoHsz",appKey:"eQc0CtLv9s4VTdObz6ux8lVW",notify:"false",verify:"false",avatar:"wavatar",placeholder:"Leave your comments here...",visitor:"true"})</script></div></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><footer class=footer><span>&copy; 2023 <a href=https://xuchengpeng.github.io/>Chuck</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span></footer><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>