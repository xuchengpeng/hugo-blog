<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SourceInsight代码检视 | Chuck</title><meta name=keywords content="SourceInsight,CodeReview"><meta name=description content="这是一个SourceInsight使用的本地代码检视工具，利用Macro实现。"><meta name=author content="Chuck"><link rel=canonical href=https://xuchengpeng.github.io/post/sourceinsight-codereview/><link crossorigin=anonymous href=/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://xuchengpeng.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://xuchengpeng.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://xuchengpeng.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://xuchengpeng.github.io/apple-touch-icon.png><link rel=mask-icon href=https://xuchengpeng.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=text/javascript async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>
    MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        displayMath: [['$$','$$'], ['\[','\]']],
        processEscapes: true,
        processEnvironments: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
        TeX: { equationNumbers: { autoNumber: "AMS" },
            extensions: ["AMSmath.js", "AMSsymbols.js"] }
    }
    });
    </script><meta property="og:title" content="SourceInsight代码检视"><meta property="og:description" content="这是一个SourceInsight使用的本地代码检视工具，利用Macro实现。"><meta property="og:type" content="article"><meta property="og:url" content="https://xuchengpeng.github.io/post/sourceinsight-codereview/"><meta property="article:section" content="post"><meta property="article:published_time" content="2017-11-20T17:10:00+00:00"><meta property="article:modified_time" content="2017-11-20T17:10:00+00:00"><meta property="og:site_name" content="Chuck"><meta name=twitter:card content="summary"><meta name=twitter:title content="SourceInsight代码检视"><meta name=twitter:description content="这是一个SourceInsight使用的本地代码检视工具，利用Macro实现。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://xuchengpeng.github.io/post/"},{"@type":"ListItem","position":2,"name":"SourceInsight代码检视","item":"https://xuchengpeng.github.io/post/sourceinsight-codereview/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SourceInsight代码检视","name":"SourceInsight代码检视","description":"这是一个SourceInsight使用的本地代码检视工具，利用Macro实现。\n","keywords":["SourceInsight","CodeReview"],"articleBody":"这是一个SourceInsight使用的本地代码检视工具，利用Macro实现。\n创建CodeReview.em文件 将代码保存为CodeReview.em文件。\n添加到base工程 将CodeReview.em文件复制到base工程目录下。\n设置快捷键 在SourceInsight中设置“Review_Add_Comment”、“Review_Restore_Link”和“Review_Summary”等相关宏的快捷键即可使用。\n/** * * Code Review Tool * * Author: FN QD * * Amendment List: * * 2003.1.22 Javey * 1) Changed severity level according to the review form * 2) Excluded the category of \"suggestion\" when counting * total defects by category to comply with the review form * 2003.5.14 Javey *1) Forced reviewers to fill category and defect type. *2) Removed these categories:SysReq,SDes,Docs and Others * from summary section */ macro GetReviewToolVersion() { return \"2.0.2\" } macro GetReviewDate() { SysTime = GetSysTime(1) szYear=SysTime.Year szMonth=SysTime.month szDay=SysTime.day return \"@szYear@-@szMonth@-@szDay@\" } macro Review_Restore_Link() { hbuf = GetCurrentBuf() //sProjRoot = GetProjDir(GetCurrentProj()) sProjRoot = Cat(sProjRoot, \"\\\\\") line = 0 while(True) { sel = SearchInBuf(hbuf, \"FileName : \", line, 0, 1, 0, 0) if(sel == \"\") break line = sel.lnFirst col = sel.ichLim str = GetBufLine(hbuf, line) fileName = strmid(str, col, strlen(str)) //fileName = cat(sProjRoot, fileName) str = GetBufLine(hbuf, line+1) lnNumber = strmid(str, 11, strlen(str)) SetSourceLink(hbuf, line, fileName, lnNumber - 1) line = line+2 } //updateSummary(hbuf) } macro Review_Add_Comment() { hbuf = GetCurrentBuf() curFileName = GetBufName(hbuf) sProjRoot = GetProjDir(GetCurrentProj()) //nPos = strlen(sProjRoot) //sFileName = strmid(curFileName, nPos+1, strlen(curFileName)) //ln从0开始编号 curLineNumber = GetBufLnCur(hbuf) totalline = GetBufLineCount (hbuf) curFunc = nil symbolrecord = nil cTempLine = curLineNumber /*下面处理主要解决空行、注释行symbol为空的问题*/ /*GetSymbolLocationFromLn参数ln是从0编号*/ while ((symbolrecord == nil) \u0026\u0026 (cTempLine","wordCount":"2245","inLanguage":"en","datePublished":"2017-11-20T17:10:00Z","dateModified":"2017-11-20T17:10:00Z","author":{"@type":"Person","name":"Chuck"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xuchengpeng.github.io/post/sourceinsight-codereview/"},"publisher":{"@type":"Organization","name":"Chuck","logo":{"@type":"ImageObject","url":"https://xuchengpeng.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xuchengpeng.github.io/ accesskey=h title="Chuck (Alt + H)"><img src=https://xuchengpeng.github.io/apple-touch-icon.png alt aria-label=logo height=35>Chuck</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://xuchengpeng.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://xuchengpeng.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://xuchengpeng.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://xuchengpeng.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://xuchengpeng.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://xuchengpeng.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://xuchengpeng.github.io/post/>Posts</a></div><h1 class=post-title>SourceInsight代码检视</h1><div class=post-meta><span title='2017-11-20 17:10:00 +0000 UTC'>November 20, 2017</span>&nbsp;·&nbsp;11 min&nbsp;·&nbsp;2245 words&nbsp;·&nbsp;Chuck&nbsp;|&nbsp;<a href=https://github.com/xuchengpeng/xuchengpeng.github.io/tree/main/content/post/sourceinsight-codereview.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#创建codereviewem文件>创建CodeReview.em文件</a></li><li><a href=#添加到base工程>添加到base工程</a></li><li><a href=#设置快捷键>设置快捷键</a></li></ul></nav></div></details></div><div class=post-content><p>这是一个SourceInsight使用的本地代码检视工具，利用Macro实现。</p><h2 id=创建codereviewem文件>创建CodeReview.em文件<a hidden class=anchor aria-hidden=true href=#创建codereviewem文件>#</a></h2><p>将代码保存为CodeReview.em文件。</p><h2 id=添加到base工程>添加到base工程<a hidden class=anchor aria-hidden=true href=#添加到base工程>#</a></h2><p>将CodeReview.em文件复制到base工程目录下。</p><h2 id=设置快捷键>设置快捷键<a hidden class=anchor aria-hidden=true href=#设置快捷键>#</a></h2><p>在SourceInsight中设置“Review_Add_Comment”、“Review_Restore_Link”和“Review_Summary”等相关宏的快捷键即可使用。</p><pre tabindex=0><code class=language-em data-lang=em>/**
 * 
 * Code Review Tool
 * 
 * Author: FN QD
 * 
 * Amendment List:
 *
 *   2003.1.22 Javey 
 * 1) Changed severity level according to the review form
 * 2) Excluded the category of &#34;suggestion&#34; when counting 
 *  total defects by category to comply with the review form
 *   2003.5.14 Javey 
 *1) Forced reviewers to fill category and defect type.
 *2) Removed these categories:SysReq,SDes,Docs and Others
 *  from summary section
 */

macro GetReviewToolVersion()
{
    return &#34;2.0.2&#34;
}

macro GetReviewDate()
{
    SysTime = GetSysTime(1)
    szYear=SysTime.Year
    szMonth=SysTime.month
    szDay=SysTime.day

    return &#34;@szYear@-@szMonth@-@szDay@&#34;
}

macro Review_Restore_Link()
{
    hbuf = GetCurrentBuf()

    //sProjRoot = GetProjDir(GetCurrentProj())
    sProjRoot = Cat(sProjRoot, &#34;\\&#34;)

    line = 0
    while(True)
    {
        sel = SearchInBuf(hbuf, &#34;FileName : &#34;, line, 0, 1, 0, 0)
        if(sel == &#34;&#34;) break

        line = sel.lnFirst
        col = sel.ichLim
        str = GetBufLine(hbuf, line)
        fileName = strmid(str, col, strlen(str))
        //fileName = cat(sProjRoot, fileName)

        str = GetBufLine(hbuf, line+1)
        lnNumber = strmid(str, 11, strlen(str))
        SetSourceLink(hbuf, line, fileName, lnNumber - 1)
        line = line+2
    }

    //updateSummary(hbuf)
}


macro Review_Add_Comment()
{
    hbuf = GetCurrentBuf()
    curFileName = GetBufName(hbuf)
    sProjRoot = GetProjDir(GetCurrentProj())
    //nPos = strlen(sProjRoot)
    //sFileName = strmid(curFileName, nPos+1, strlen(curFileName))

 
    //ln从0开始编号
    curLineNumber = GetBufLnCur(hbuf) 
    totalline = GetBufLineCount (hbuf)    
    curFunc = nil
    symbolrecord = nil
    cTempLine = curLineNumber    
    
    /*下面处理主要解决空行、注释行symbol为空的问题*/
    /*GetSymbolLocationFromLn参数ln是从0编号*/
    while ((symbolrecord == nil) &amp;&amp; (cTempLine&lt;totalline))
    {

         symbolrecord = GetSymbolLocationFromLn(hbuf,cTempLine)
         if (symbolrecord != nil)
         {
             curFunc = symbolrecord.Symbol
             /*对非func类的symbol，一律都显示空*/
             if ((curFunc != nil) &amp;&amp; (symbolrecord.Type != Function)
             {    
                 curFunc = nil
             }
             break;
         }                 
         cTempLine=cTempLine+1         
    }


    sFileName   = cat( &#34;FileName : &#34;, curFileName )
    sLineNumber = cat( &#34;Line     : &#34;, curLineNumber + 1 )

    /* get the severity of the current comment */
    promote = &#34;Severity : M,m(Major严重); G,g(General一般); S,s(Suggestion提示)&#34;
    sTemp = ask(promote);
    sTemp = toupper(sTemp[0]);
    while( sTemp != &#34;M&#34; &amp;&amp; sTemp != &#34;G&#34; &amp;&amp; sTemp != &#34;S&#34; )
    {
        sTemp = ask(cat(&#34;Please input again! &#34;, promote));
        sTemp = toupper(sTemp[0]);
    }

    if( sTemp == &#34;M&#34; ) sTemp = &#34;Major&#34;;
        else if ( sTemp == &#34;G&#34; ) sTemp = &#34;General&#34;;
        else if ( sTemp == &#34;S&#34; ) sTemp = &#34;Suggestion&#34;;

    sSeverity = cat( &#34;Severity : &#34;, sTemp );


    promote = &#34;Category : 1.编程规范(代码级); 2.非编码规范(代码级); 3.业务功能; 4.软件结构&#34;
    sTemp = ask(promote);

    
    ChoseNumber = AsciiFromChar(sTemp);
    MinNumber = AsciiFromChar(&#34;1&#34;);
    MaxNumber = AsciiFromChar(&#34;4&#34;);

    while ((ChoseNumber &lt; MinNumber) || (ChoseNumber &gt; MaxNumber))
    {
        sTemp = ask(promote);
        sTemp = toupper(sTemp[0]);
        ChoseNumber = AsciiFromChar(sTemp);
    }
  
    if( sTemp == &#34;1&#34; ) 
    {
        sCategory = cat( &#34;Category : &#34;, &#34;编程规范&#34;);
    }
    else if ( sTemp == &#34;2&#34; )
    {
        sCategory = cat( &#34;Category : &#34;, &#34;非编码规范&#34;);
    }
    else if ( sTemp == &#34;3&#34; )
    {
        sCategory = cat( &#34;Category : &#34;, &#34;业务功能&#34;);
    }
    else if ( sTemp == &#34;4&#34; )
    {
        sCategory = cat( &#34;Category : &#34;, &#34;软件结构&#34;);
    }

    
    if (sTemp == &#34;1&#34;) // 编程规范
    {
     
        promote = &#34;1.排版/命名 2.注释/可读性 3.常量左值/魔鬼数字 4.断言调试/打印&#34;
  
        sTemp = ask(promote);
        sTemp = toupper(sTemp[0]);
        ChoseNumber = AsciiFromChar(sTemp);
        MinNumber = AsciiFromChar(&#34;1&#34;);
        MaxNumber = AsciiFromChar(&#34;4&#34;);

        while ((ChoseNumber &lt; MinNumber) || (ChoseNumber &gt; MaxNumber))
        {
            sTemp = ask(promote);
            sTemp = toupper(sTemp[0]);
            ChoseNumber = AsciiFromChar(sTemp);
        }
        EndMsg();

        if( sTemp == &#34;1&#34; ) sTemp = &#34;排版/标识符命名&#34;;
            else if ( sTemp == &#34;2&#34; ) sTemp = &#34;注释/可读性&#34;;
            else if ( sTemp == &#34;3&#34; ) sTemp = &#34;常量左值/魔鬼数字&#34;;
            else if ( sTemp == &#34;4&#34; ) sTemp = &#34;断言调试/打印&#34;;

        sType = cat( &#34;Type     : &#34;, sTemp );
    }
    else if (sTemp == &#34;2&#34;) // 非编码规范
    {
     
        promote = &#34;1.参数/返回值/优先级 2.变量初始化和赋值 3.资源申请释放 4.中断/效率/移植性 5.循环/if/switch 6.结构/宏/枚举 7.函数逻辑 8.其他&#34;;
        
        sTemp = ask(promote);
        sTemp = toupper(sTemp[0]);
        ChoseNumber = AsciiFromChar(sTemp);
        MinNumber = AsciiFromChar(&#34;1&#34;);
        MaxNumber = AsciiFromChar(&#34;8&#34;);

        

        while ((ChoseNumber &lt; MinNumber) || (ChoseNumber &gt; MaxNumber))
        {
            sTemp = ask(promote);
            sTemp = toupper(sTemp[0]);
            ChoseNumber = AsciiFromChar(sTemp);
        }
        EndMsg();

        if( sTemp == &#34;1&#34; ) sTemp = &#34;函数参数/返回值检查/操作符优先级&#34;;
            else if ( sTemp == &#34;2&#34; ) sTemp = &#34;变量/指针/数组/字符串初始化和赋值&#34;;
            else if ( sTemp == &#34;3&#34; ) sTemp = &#34;资源申请和释放&#34;;
            else if ( sTemp == &#34;4&#34; ) sTemp = &#34;中断/效率/可移植性&#34;;
            else if ( sTemp == &#34;5&#34; ) sTemp = &#34;循环/if/switch程序块&#34;;
            else if ( sTemp == &#34;6&#34; ) sTemp = &#34;结构/宏/枚举定义和使用&#34;;
            else if ( sTemp == &#34;7&#34; ) sTemp = &#34;函数逻辑控制&#34;;
            else if ( sTemp == &#34;8&#34; ) sTemp = &#34;其他&#34;;

            sType = cat( &#34;Type     : &#34;, sTemp );
    }
    else if ( sTemp == &#34;3&#34; ) // 业务功能
    {
        promote = &#34;1.功能需求遗漏 2.功能需求没有正确实现&#34;
        
        sTemp = ask(promote);
        sTemp = toupper(sTemp[0]);
        ChoseNumber = AsciiFromChar(sTemp);
        MinNumber = AsciiFromChar(&#34;1&#34;);
        MaxNumber = AsciiFromChar(&#34;2&#34;);

        while ((ChoseNumber &lt; MinNumber) || (ChoseNumber &gt; MaxNumber))
        {
            sTemp = ask(promote);
            sTemp = toupper(sTemp[0]);
            ChoseNumber = AsciiFromChar(sTemp);
        }
        EndMsg();

        if( sTemp == &#34;1&#34; ) sTemp = &#34;功能需求遗漏&#34;;
        else if ( sTemp == &#34;2&#34; ) sTemp = &#34;功能需求没有正确实现&#34;;


        sType = cat( &#34;Type     : &#34;, sTemp );    
    }
    else if ( sTemp == &#34;4&#34; ) // 软件结构
    {
        promote = &#34;1.函数功能不单一 2.函数复杂度高 3.数据依赖多(全局，局部变量，参数) 4.全局变量访问不合理 5.冗余重复代码 6.其他&#34;
        
        sTemp = ask(promote);
        sTemp = toupper(sTemp[0]);
        ChoseNumber = AsciiFromChar(sTemp);
        MinNumber = AsciiFromChar(&#34;1&#34;);
        MaxNumber = AsciiFromChar(&#34;6&#34;);

        while ((ChoseNumber &lt; MinNumber) || (ChoseNumber &gt; MaxNumber))
        {
            sTemp = ask(promote);
            sTemp = toupper(sTemp[0]);
            ChoseNumber = AsciiFromChar(sTemp);
        }
        EndMsg();

        if( sTemp == &#34;1&#34; ) sTemp = &#34;函数功能不单一&#34;;
        else if ( sTemp == &#34;2&#34; ) sTemp = &#34;函数复杂度高&#34;;
        else if ( sTemp == &#34;3&#34; ) sTemp = &#34;数据依赖多(全局，局部变量，参数)&#34;;
        else if ( sTemp == &#34;4&#34; ) sTemp = &#34;全局变量访问不合理&#34;;
        else if ( sTemp == &#34;5&#34; ) sTemp = &#34;冗余重复代码&#34;; 
        else if ( sTemp == &#34;6&#34; ) sTemp = &#34;其他&#34;;         
        sType = cat( &#34;Type     : &#34;, sTemp );    
    }    
    

    /* get the comment */
    promote = &#34;Input your comment:&#34;
    sTemp = ask(promote);
    sComments = cat( &#34;Comments : &#34;, sTemp );

    /* get the licence user name for the reviewer name */
    progRecord = GetProgramEnvironmentInfo()
    sMyName = progRecord.UserName
    szReviewDate = GetReviewDate()
    szReviewFileName = &#34;ReviewComment_@sMyName@_@szReviewDate@.txt&#34;
    
    /* get the ReviewComment buffer handle */
    bNewCreated = false; // used for the review comment is firstly created

    hout = GetBufHandle(szReviewFileName)
    if (hout == hNil)
    {
        // No existing Review Comment buffer
        hout= OpenBuf (szReviewFileName)
        if( hout == hNil )
        {
            /* No existing ReviewComment.txt, then create a new review comment buffer */
            hout = NewBuf(szReviewFileName)
            NewWnd(hout)
            bNewCreated = true

            /*----------------------------------------------------------------*/
            /* Get the owner&#39;s name from the environment variable: MYNAME.    */
            /* If the variable doesn&#39;t exist, then the owner field is skipped.*/
            /*----------------------------------------------------------------*/

            AppendBufLine(hout, &#34;[Review Info] &#34;)
            AppendBufLine(hout, cat(&#34;ReviewTool Version    : &#34;, GetReviewToolVersion()))
            AppendBufLine(hout, cat(&#34;Reviewer Name         : &#34;, sMyName))
            sDate = GetSysTime(1)
            AppendBufLine(hout, cat(&#34;Review   Date         : &#34;, sDate.date))
		    /* Size summary */
		    AppendBufLine(hout, &#34;Review size(KLOC)     : &#34;)              
		    /* Effort summary */
		    AppendBufLine(hout, &#34;Review effort(P*Hours): &#34;)
		    AppendBufLine(hout, &#34;Rework effort(P*Hours): &#34;)    	    
            AppendBufLine(hout, &#34;-------------------------------------------------------------------------&#34;)
            AppendBufLine(hout, &#34;&#34;)

        }
    } // end of get ReviewComment buffer handle

    delSummary(hout)
    AppendBufLine(hout, sFileName)
    AppendBufLine(hout, sLineNumber)
    AppendBufLine(hout, cat(&#34;Reviewer : &#34;, sMyName))
    AppendBufLine(hout, cat(&#34;Symbol   : &#34;, curFunc) )
    AppendBufLine(hout, sSeverity)
    AppendBufLine(hout, &#34;Status   : Open&#34;)
    AppendBufLine(hout, sComments)
    AppendBufLine(hout, &#34;Resolve  : &#34;)
    AppendBufLine(hout, sCategory)
    AppendBufLine(hout, sType)
    AppendBufLine(hout, &#34;Author   : &#34;)
    AppendBufLine(hout, &#34;Phase    : &#34;)
    AppendBufLine(hout, &#34;&#34;)

    lnSource = GetBufLineCount(hout) - 12
    SetSourceLink(hout, lnSource, curFileName, curLineNumber)
    updateSummary(hout)
    if( bNewCreated ) SetCurrentBuf(hbuf)
    jump_to_link;
}

macro Review_Summary()
{
    hbuf = GetCurrentBuf()
 
    updateSummary(hbuf)
}

macro updateSummary(hbuf)
{
    rvSum0 = getReviewSummary(hbuf)
    rvSum = &#34;major=\&#34;0\&#34;;general=\&#34;0\&#34;;suggestion=\&#34;0\&#34;;open=\&#34;0\&#34;;closed=\&#34;0\&#34;;rejected=\&#34;0\&#34;;duplicate=\&#34;0\&#34;;discuss=\&#34;0\&#34;;SysReq=\&#34;0\&#34;;SDes=\&#34;0\&#34;;SRS=\&#34;0\&#34;;HLD=\&#34;0\&#34;;LLD=\&#34;0\&#34;;TP=\&#34;0\&#34;;Code=\&#34;0\&#34;;Docs=\&#34;0\&#34;;Others=\&#34;0\&#34;&#34;

    /* summary the severity */
    ln = 0
    while (True)
    {
        sel = SearchInBuf(hbuf, &#34;^Severity\\s+:\\s+&#34;, ln, 0, 1, 1, 0)
        if (sel == null) break

        ln = sel.lnFirst
        col = sel.ichLim
        s = GetBufLine(hbuf, ln)
        sTemp = strmid(s, col, col+1)
        sTemp = toupper(sTemp);

        if (sTemp == &#34;M&#34; &amp;&amp; validDefect(hbuf, ln)) 
            rvSum.major = rvSum.major + 1
        else if (sTemp == &#34;G&#34; &amp;&amp; validDefect(hbuf, ln))
            rvSum.general = rvSum.general + 1
        else if (sTemp == &#34;S&#34; &amp;&amp; validDefect(hbuf, ln))
            rvSum.suggestion = rvSum.suggestion + 1

        ln = ln + 1
    }

    /* summary the satus */
    ln = 0
    while (True)
    {
        sel = SearchInBuf(hbuf, &#34;^Status\\s+:\\s+&#34;, ln, 0, 1, 1, 0)
        if (sel == null) break

        ln = sel.lnFirst
        col = sel.ichLim
        s = GetBufLine(hbuf, ln)      
        sTemp = strmid(s, col, col+1)
        sTemp = toupper(sTemp);

        if (sTemp == &#34;O&#34;) rvSum.open = rvSum.open + 1
        else if (sTemp == &#34;C&#34;)  rvSum.closed = rvSum.closed + 1
        else if (sTemp == &#34;R&#34;)  rvSum.rejected = rvSum.rejected + 1
        else if (sTemp == &#34;D&#34;)
        {
            sTemp = strmid(s, col+1, col+2)
            sTemp = toupper(sTemp);
            
            if (sTemp == &#34;U&#34;)  rvSum.duplicate = rvSum.duplicate + 1
               else if (sTemp == &#34;I&#34;)  rvSum.discuss = rvSum.discuss + 1                    
        }
        
        ln = ln + 1
    }

    /* summary the categories */
    /*ln = 0
    while (True)
    {
        norej = norejected(hbuf, ln);
        notsug = notsuggestion(hbuf, ln)
        sel = SearchInBuf(hbuf, &#34;^Category\\s+:\\s+&#34;, ln, 0, 1, 1, 0)
        if (sel == null) break

        ln = sel.lnFirst
        col = sel.ichLim
        s = GetBufLine(hbuf, ln)
        if ( col+2 &gt; strlen(s)) 
        {
            msg(&#34;Please write categories!&#34;)
            return
        }
        sTemp = strmid(s, col, col+2)
            sTemp = toupper(sTEmp);

        if (sTemp == &#34;SY&#34; &amp;&amp; norej &amp;&amp; notsug) rvSum.SysReq = rvSum.SysReq + 1
            else if (sTemp == &#34;SD&#34; &amp;&amp; norej &amp;&amp; notsug)  rvSum.SDes = rvSum.SDes + 1
            else if (sTemp == &#34;SR&#34; &amp;&amp; norej &amp;&amp; notsug)  rvSum.SRS = rvSum.SRS + 1
            else if (sTemp == &#34;HL&#34; &amp;&amp; norej &amp;&amp; notsug)  rvSum.HLD = rvSum.HLD + 1
            else if (sTemp == &#34;LL&#34; &amp;&amp; norej &amp;&amp; notsug)  rvSum.LLD = rvSum.LLD + 1
            else if (sTemp == &#34;TP&#34; &amp;&amp; norej &amp;&amp; notsug)  rvSum.TP = rvSum.TP + 1
            else if (sTemp == &#34;CO&#34; &amp;&amp; norej &amp;&amp; notsug)  rvSum.Code = rvSum.Code + 1
            else if (sTemp == &#34;DO&#34; &amp;&amp; norej &amp;&amp; notsug)  rvSum.Docs = rvSum.Docs + 1
            else if (sTemp == &#34;OT&#34; &amp;&amp; norej &amp;&amp; notsug)  rvSum.Others = rvSum.Others + 1

            ln = ln + 1
    }*/

    if ( rvSum.major == rvSum0.major &amp;&amp; rvSum.general == rvSum0.general &amp;&amp; rvSum.suggestion == rvSum0.suggestion 
         &amp;&amp;rvSum.open == rvSum0.open &amp;&amp; rvSum.closed == rvSum0.closed &amp;&amp; rvSum.rejected == rvSum0.rejected 
         &amp;&amp;rvSum.duplicate == rvSum0.duplicate &amp;&amp; rvSum.discuss == rvSum0.discuss 
        /*&amp;&amp;
        rvSum.SysReq == rvSum0.SysReq &amp;&amp; rvSum.SDes == rvSum0.SDes &amp;&amp;
        rvSum.SRS == rvSum0.SRS &amp;&amp; rvSum.HLD == rvSum0.HLD &amp;&amp;
        rvSum.LLD == rvSum0.LLD &amp;&amp; rvSum.TP == rvSum0.TP &amp;&amp;
        rvSum.Code == rvSum0.Code &amp;&amp; rvSum.Docs == rvSum0.Docs &amp;&amp;
        rvSum.Others == rvSum0.Others*/ )
        return
    else
    {
        delSummary(hbuf)
        setReviewSummary(hbuf, rvSum)
    }
}

macro getReviewSummary(hbuf)
{
    sel = SearchInBuf(hbuf, &#34;^Summary$&#34;, 0, 0, 1, 1, 0)
    rvSum = &#34;major=\&#34;0\&#34;;general=\&#34;0\&#34;;suggestion=\&#34;0\&#34;;open=\&#34;0\&#34;;closed=\&#34;0\&#34;;rejected=\&#34;0\&#34;;duplicate=\&#34;0\&#34;;discuss=\&#34;0\&#34;;revieweffort=\&#34;0\&#34;;reworkeffort=\&#34;0\&#34;;reviewsize=\&#34;0\&#34;&#34;

    if (sel == null)
        return rvSum

    /* get severity summary */
    ln = sel.lnFirst + 2
    sel = SearchInBuf(hbuf, &#34;^Major\\s+:\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.major = strmid(sLine, col, strlen(sLine))

    sel = SearchInBuf(hbuf, &#34;^General\\s+:\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.general = strmid(sLine, col, strlen(sLine))

    sel = SearchInBuf(hbuf, &#34;^Suggestion\\s+:\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.suggestion = strmid(sLine, col, strlen(sLine))

    /* get status summary */
    sel = SearchInBuf(hbuf, &#34;^Open\\s+:\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.open = strmid(sLine, col, strlen(sLine))

    sel = SearchInBuf(hbuf, &#34;^Closed\\s+:\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.closed = strmid(sLine, col, strlen(sLine))

    sel = SearchInBuf(hbuf, &#34;^Duplicated\\s+:\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.duplicate = strmid(sLine, col, strlen(sLine))

    sel = SearchInBuf(hbuf, &#34;^Discuss\\s+:\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.discuss = strmid(sLine, col, strlen(sLine))
  

    /* get categories summary */
    /*sel = SearchInBuf(hbuf, &#34;^SysReq\\s+=\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.SysReq = strmid(sLine, col, strlen(sLine))

    sel = SearchInBuf(hbuf, &#34;^SDes\\s+=\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.SDes = strmid(sLine, col, strlen(sLine))

    sel = SearchInBuf(hbuf, &#34;^SRS\\s+=\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.SRS = strmid(sLine, col, strlen(sLine))

    sel = SearchInBuf(hbuf, &#34;^HLD\\s+=\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.HLD = strmid(sLine, col, strlen(sLine))

    sel = SearchInBuf(hbuf, &#34;^LLD\\s+=\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.LLD = strmid(sLine, col, strlen(sLine))

    sel = SearchInBuf(hbuf, &#34;^TP\\s+=\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.TP = strmid(sLine, col, strlen(sLine))

    sel = SearchInBuf(hbuf, &#34;^Code\\s+=\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.Code = strmid(sLine, col, strlen(sLine))

    sel = SearchInBuf(hbuf, &#34;^Docs\\s+=\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.Docs = strmid(sLine, col, strlen(sLine))

    sel = SearchInBuf(hbuf, &#34;^Others\\s+=\\s+&#34;, ln, 0, 1, 1, 0)
    col = sel.ichLim
    sLine = GetBufLine(hbuf, sel.lnFirst)
    rvSum.Others = strmid(sLine, col, strlen(sLine))*/

    return rvSum
}

macro setReviewSummary(hbuf, rvSum)
{
    AppendBufLine(hbuf, &#34;Summary&#34;)
    AppendBufLine(hbuf, &#34;-------------------------------------------------------------------------&#34;)

    /* Defects sumary */
    AppendBufLine(hbuf, &#34;[Defects Summary]&#34;)
    s = Cat(&#34;Total defects : &#34;, rvSum.major + rvSum.general + rvSum.suggestion)
    AppendBufLine(hbuf, s)
    s = Cat(&#34;Major         : &#34;, rvSum.major)
    AppendBufLine(hbuf, s)
    s = Cat(&#34;General       : &#34;, rvSum.general)
    AppendBufLine(hbuf, s)
    s = Cat(&#34;Suggestion    : &#34;, rvSum.suggestion)
    AppendBufLine(hbuf, s)

    /* Status sumary */
    AppendBufLine(hbuf, &#34;&#34;)
    AppendBufLine(hbuf, &#34;[Status Summary]&#34;)
    s = Cat(&#34;Open          : &#34;, rvSum.open)
    AppendBufLine(hbuf, s)
    s = Cat(&#34;Closed        : &#34;, rvSum.closed)
    AppendBufLine(hbuf, s)
    s = Cat(&#34;Rejected      : &#34;, rvSum.rejected)
    AppendBufLine(hbuf, s)
    s = Cat(&#34;Duplicated    : &#34;, rvSum.duplicate)
    AppendBufLine(hbuf, s)
    s = Cat(&#34;Discuss       : &#34;, rvSum.discuss)
    AppendBufLine(hbuf, s) 


}

macro delSummary(hbuf)
{
    sel = SearchInBuf(hbuf, &#34;^Summary$&#34;, 0, 0, 1, 1, 0)

    if (sel == null)
        return 
    else
    {
        ln = sel.lnFirst
        LineCount = GetBufLineCount(hbuf) - 1

        while(LineCount &gt;= ln)
        {
            DelBufLine(hbuf, LineCount)
            LineCount = LineCount -1;
        }
    }
}

macro validDefect(hbuf, ln)
{
    sel = SearchInBuf(hbuf, &#34;^Status\\s+:\\s+&#34;, ln, 0, 1, 1, 0)
    if (sel == null) return True;

    ln = sel.lnFirst
    col = sel.ichLim
    s = GetBufLine(hbuf, ln)

    sTemp = strmid(s, col, col+1)
    sTemp = toupper(sTemp);

    if (sTemp == &#34;R&#34;) return  False;
    else if (sTemp == &#34;D&#34;)
    {
         sTemp = strmid(s, col+1, col+2)
         sTemp = toupper(sTemp);

         if (sTemp == &#34;U&#34;) return  False;    
    }

   
    return True;
}

macro notsuggestion(hbuf, ln)
{
    sel = SearchInBuf(hbuf, &#34;^Severity\\s+:\\s+&#34;, ln, 0, 1, 1, 0)
    if (sel == null) return True;

    ln = sel.lnFirst
    col = sel.ichLim
    s = GetBufLine(hbuf, ln)
    sTemp = strmid(s, col, col+1)
    sTemp = toupper(sTEmp);

    if (sTemp == &#34;S&#34;) return  False;

    return True;
}
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://xuchengpeng.github.io/tags/sourceinsight/>SourceInsight</a></li><li><a href=https://xuchengpeng.github.io/tags/codereview/>CodeReview</a></li></ul><nav class=paginav><a class=prev href=https://xuchengpeng.github.io/post/google-chrome-download-addr/><span class=title>« Prev</span><br><span>Google Chrome下载地址</span></a>
<a class=next href=https://xuchengpeng.github.io/post/hello-world/><span class=title>Next »</span><br><span>Hello World</span></a></nav></footer><div class=article-comments><span id=/post/sourceinsight-codereview/ class=leancloud-visitors data-flag-title=SourceInsight代码检视><span class=post-meta-item-text>文章阅读量</span>
<span class=leancloud-visitors-count>0</span></span><div id=vcomments></div><script src=//unpkg.com/valine/dist/Valine.min.js></script>
<script type=text/javascript>new Valine({el:"#vcomments",appId:"8cGx0mI721mXnuSact0PLKmV-gzGzoHsz",appKey:"eQc0CtLv9s4VTdObz6ux8lVW",notify:"false",verify:"false",avatar:"wavatar",placeholder:"Leave your comments here...",visitor:"true"})</script></div></article></main><footer class=footer><span>&copy; 2023 <a href=https://xuchengpeng.github.io/>Chuck</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>